$(function(){function a(){c.off("click"),c.remove(),d.removeClass("popup_active")}function b(b){var i=_.template(e);c=$(i({data:b?b:{}}));var j=c.find("form");c.on("click",".btn-save",function(c){c.preventDefault();var d={id:b?b.id:null,subject:j.find('[name="subject"]').val(),text:j.find('[name="text"]').val()};$.ajax({url:j.attr("action"),type:"GET",dataType:"json",data:d,success:function(c){if(a(),b&&b.id){var e=_.findIndex(emailNotificationsData,function(a){return a.id==b.id}),i=h.filter('[data-id="'+b.id+'"]');$.extend(emailNotificationsData[e],d),i.find(".email-notification-label").text(b.label),i.find(".email-notification-subject").text(b.subject),i.find(".email-notification-text").text(b.text)}else{d.id||(d.id=Math.random()+"");var j=_.template(f),k=j({data:c.data?c.data:d,isOdd:h.length%2==0});g.append(k),h=g.find(".email-notification-item"),emailNotificationsData.push(c.data?c.data:d)}},error:function(a){alert("Something went wrong")}})}),d.addClass("popup_active").append(c)}var c,d=$("#popup_block"),e=$("#edit-notification-tpl").html(),f=$("#email-notification-item-tpl").html(),g=$(".email-notification-block"),h=g.find(".email-notification-item");-1!=navigator.userAgent.toLowerCase().indexOf("msie")&&$(".wrap_table > div:nth-child(odd)").addClass("odd"),$(".btn-add-notification").on("click",function(a){a.preventDefault(),b()}),g.on("click",".btn-edit",function(a){a.preventDefault();var c=$(a.currentTarget).closest(".email-notification-item").data("id")+"",d=_.where(emailNotificationsData,{id:c})[0];b(d)}),d.on("click","#popup_fone",function(){a()})});